# Настройка автоматического деплоя в Windows

Этот документ содержит подробные инструкции по настройке автоматического деплоя в среде Windows.

## Генерация SSH-ключей в Windows

### Использование скрипта автоматической генерации

Для удобства генерации SSH-ключей вы можете использовать подготовленный PowerShell скрипт:

1. Откройте PowerShell от имени администратора
2. Перейдите в директорию проекта
3. Выполните скрипт:
   ```powershell
   .\scripts\generate_ssh_keys.ps1
   ```
4. Следуйте инструкциям на экране

### Ручная генерация SSH-ключей

Если вы предпочитаете создать ключи вручную:

1. Убедитесь, что у вас установлен OpenSSH Client:
   - Откройте **Параметры Windows > Приложения > Дополнительные компоненты**
   - Нажмите **Добавить компонент** и найдите **OpenSSH Client**
   - Установите его, если он отсутствует

2. Откройте PowerShell и выполните команду:
   ```powershell
   ssh-keygen -t rsa -b 4096 -C "your_email@example.com" -f "$env:USERPROFILE\.ssh\deploy_key"
   ```

3. Нажмите Enter, когда будет предложено ввести пароль (оставьте пустым для автоматического деплоя)

## Настройка деплоя в PowerShell

### Обновление скрипта деплоя

Откройте файл `deploy.ps1` и обновите следующие параметры:

```powershell
$SERVER_USER = "ваш_пользователь"
$SERVER_HOST = "ваш_сервер"
$SERVER_PATH = "/путь/к/директории/на/сервере"
```

### Запуск деплоя вручную

Для ручного запуска деплоя выполните в PowerShell:

```powershell
.\deploy.ps1
```

## Настройка GitHub Actions для Windows

1. Убедитесь, что в вашем репозитории есть файл `.github/workflows/auto_deploy.yml`
2. Добавьте секреты в настройках репозитория GitHub:
   - Перейдите в **Settings > Secrets and variables > Actions**
   - Добавьте следующие секреты:
     - `SSH_PRIVATE_KEY`: содержимое файла `%USERPROFILE%\.ssh\deploy_key`
     - `SERVER_HOST`: IP-адрес или домен вашего сервера
     - `SERVER_USER`: имя пользователя для SSH-подключения
     - `SERVER_PATH`: путь к директории проекта на сервере

## Проверка настройки

1. Внесите небольшое изменение в код
2. Отправьте изменения в репозиторий:
   ```powershell
   git add .
   git commit -m "Тестирование автоматического деплоя"
   git push
   ```
3. Перейдите в раздел **Actions** на GitHub и убедитесь, что процесс деплоя запустился и успешно завершился

## Устранение неполадок в Windows

### Проблемы с SSH

- **Ошибка "Permission denied (publickey)"**: Убедитесь, что публичный ключ правильно добавлен в файл `authorized_keys` на сервере
- **Ошибка "Host key verification failed"**: Выполните команду `ssh-keyscan ваш_сервер >> %USERPROFILE%\.ssh\known_hosts`

### Проблемы с PowerShell

- **Ошибка выполнения скриптов**: Если PowerShell не позволяет выполнять скрипты, измените политику выполнения:
  ```powershell
  Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
  ```

### Проблемы с GitHub Actions

- **Ошибка в формате приватного ключа**: Убедитесь, что при копировании приватного ключа в секрет GitHub сохранены все переносы строк
- **Ошибка доступа к серверу**: Проверьте правильность указанных секретов `SERVER_HOST`, `SERVER_USER` и `SERVER_PATH`

## Дополнительная информация

Для более подробной информации о настройке SSH-ключей обратитесь к файлу `docs/ssh_key_setup.md`.

Для настройки SFTP-соединения в FileZilla обратитесь к файлу `docs/filezilla_sftp_setup.md`.