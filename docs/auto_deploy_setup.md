# Настройка автоматического деплоя

Этот документ содержит инструкции по настройке автоматического обновления кода на сервере при изменениях в репозитории.

## Настройка GitHub Actions

Если вы используете GitHub для хранения кода, выполните следующие шаги:

1. Убедитесь, что файл `.github/workflows/auto_deploy.yml` присутствует в вашем репозитории.
2. В настройках репозитория GitHub перейдите в раздел **Settings > Secrets and variables > Actions**.
3. Добавьте следующие секреты:
   - `SSH_PRIVATE_KEY`: приватный SSH-ключ для подключения к серверу
   - `SERVER_HOST`: IP-адрес или домен сервера
   - `SERVER_USER`: имя пользователя для SSH-подключения
   - `SERVER_PATH`: путь к директории проекта на сервере

## Настройка GitLab CI/CD

Если вы используете GitLab для хранения кода, выполните следующие шаги:

1. Убедитесь, что файл `.gitlab-ci.yml` присутствует в вашем репозитории.
2. В настройках проекта GitLab перейдите в раздел **Settings > CI/CD > Variables**.
3. Добавьте следующие переменные:
   - `SSH_PRIVATE_KEY`: приватный SSH-ключ для подключения к серверу
   - `SSH_KNOWN_HOSTS`: содержимое файла known_hosts для SSH
   - `SERVER_HOST`: IP-адрес или домен сервера
   - `SERVER_USER`: имя пользователя для SSH-подключения
   - `SERVER_PATH`: путь к директории проекта на сервере

## Настройка SSH-ключей

1. Создайте пару SSH-ключей на вашем локальном компьютере:
   ```bash
   ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
   ```

2. Добавьте публичный ключ на сервер:
   ```bash
   ssh-copy-id user@server_host
   ```

3. Скопируйте содержимое приватного ключа (`~/.ssh/id_rsa`) и добавьте его в секреты GitHub или переменные GitLab.

## Проверка настройки

1. Внесите небольшое изменение в код и отправьте его в репозиторий:
   ```bash
   git add .
   git commit -m "Тестирование автоматического деплоя"
   git push
   ```

2. Перейдите в раздел Actions (GitHub) или CI/CD > Pipelines (GitLab) и убедитесь, что процесс деплоя запустился и успешно завершился.

3. Проверьте, что изменения появились на сервере.

## Устранение неполадок

- **Ошибка доступа SSH**: Убедитесь, что приватный ключ добавлен в секреты/переменные и имеет правильный формат.
- **Ошибка при запуске Docker**: Проверьте, что Docker и Docker Compose установлены на сервере и пользователь имеет права на их использование.
- **Ошибка при копировании файлов**: Проверьте, что указан правильный путь к директории проекта на сервере и пользователь имеет права на запись в эту директорию.